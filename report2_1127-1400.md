# 项目目标达成度评估（区块链系统架构）

日期：2025-11-27

## 概览
- 定位：本项目是区块链中间件（Fabric Gateway Service），通过 REST API 为业务系统提供存证服务。
- 综合达成度（估算）：约 60%（已完成项 2，部分完成项 6，未开展项 1）。

## 目标与状态

### 跨模块对接（RESTful API / SDK 支持）
- 当前状态：已完成
- 证据：
  - 控制器基础路径 `@RequestMapping("/api")` 与 CORS 放开 `@CrossOrigin`（src/main/java/com/example/blockchain/BlockchainController.java:13、src/main/java/com/example/blockchain/BlockchainController.java:14）
  - 写入接口 `POST /api/evidence`（src/main/java/com/example/blockchain/BlockchainController.java:24）
  - 查询接口 `GET /api/evidence/{id}`（src/main/java/com/example/blockchain/BlockchainController.java:43）
  - 校验接口 `POST /api/verify`（src/main/java/com/example/blockchain/BlockchainController.java:61）
  - Fabric SDK 接入为 Spring Bean `Contract`（src/main/java/com/example/blockchain/FabricConfig.java:31）
- 待完善：端口冲突治理、接口鉴权、错误码与文档化。

### 保障数据不可篡改（上链存证）
- 当前状态：已完成（依赖 Fabric 的不可篡改特性）
- 证据：
  - 异步入队上链，批量调用链码 `submitEvidenceBatch`（src/main/java/com/example/blockchain/service/AsyncService.java:68）
  - 查询接口通过 `evaluateTransaction("getEvidenceByEventID", id)` 获取链上数据（src/main/java/com/example/blockchain/BlockchainController.java:48）
- 待完善：实际业务文件计算 SHA256 并填充 `dataHash`；链码层数据模型与重复 ID 策略。

### 运维管理与优化（批处理、熔断、重试、性能）
- 当前状态：部分完成
- 证据：
  - 队列与后台线程批处理（src/main/java/com/example/blockchain/service/AsyncService.java:36、src/main/java/com/example/blockchain/service/AsyncService.java:49）
  - 熔断回退与限次重试（src/main/java/com/example/blockchain/service/AsyncService.java:74、src/main/java/com/example/blockchain/service/AsyncService.java:86）
- 待完善：优雅停机、线程池替换、监控指标、健康检查与告警。

### 网络部署与运维（Peer/Orderer、环境）
- 当前状态：部分完成（针对 test-network）
- 证据：
  - 一键脚本部署 Java 链码到 `mychannel`（start_infra.sh:44）
  - 配置直连 test-network 的连接文件与证书（src/main/resources/application.yml:4、src/main/resources/application.yml:8、src/main/resources/application.yml:12、src/main/resources/application.yml:15、src/main/resources/application.yml:17）
- 待完善：生产网络拓扑、证书轮换、组织扩展与治理流程。

### 多组织通道隔离与权限控制
- 当前状态：部分完成（单组织接入）
- 证据：
  - 当前使用 Org1 身份连接 `mychannel` 合约 `evidence`（src/main/resources/application.yml:15、src/main/resources/application.yml:17）
- 待完善：多组织身份与通道管理、细粒度访问控制。

### 权限与安全管控（角色体系、鉴权）
- 当前状态：未开展
- 证据：
  - 无认证鉴权与角色控制代码；接口全量 CORS 放开（src/main/java/com/example/blockchain/BlockchainController.java:14）
- 待完善：接入统一鉴权（JWT/OAuth2）、角色与租户模型、接口权限策略。

### 系统安全性（加密存储、交易验证、审计日志）
- 当前状态：部分完成
- 证据：
  - 交易通过 Fabric Gateway 提交与查询（src/main/java/com/example/blockchain/FabricConfig.java:31、src/main/java/com/example/blockchain/BlockchainController.java:48）
  - 控制台打印基础日志（src/main/java/com/example/blockchain/service/AsyncService.java:62 之后的日志输出）
- 待完善：敏感数据加密、结构化审计日志、异常告警、入侵防护。

### 持续优化与合约迭代
- 当前状态：部分完成
- 证据：
  - 文档记录了链码升级与 sequence 管理经验（Firstreport.md:60 之后的章节）
- 待完善：标准化合约版本策略、自动化发布流水线、兼容性测试。

## 建议与下一步
- 端口与对接：如需与业务后端并行运行，建议中间件端口改为 `8081` 并在客户端通过 `http://localhost:8081/api/evidence` 对接。
- 安全加固：收紧 CORS、加入鉴权与角色模型、敏感字段加密、完善审计日志。
- 可靠性：将后台线程改为线程池与健康探针；增加指标（QPS、队列深度、成功率）与告警。
- 业务一致性：在链码层定义防重复/幂等策略，确保批处理失败可定位与重放。
- 可观察性：对 REST 接口统一返回码与错误语义，补充接口文档与压测报告。

