<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>API 调试</title>
  <style>
    :root { color-scheme: light dark; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    header { padding: 16px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 12px; }
    header h1 { margin: 0; font-size: 18px; }
    main { padding: 16px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { font-size: 12px; color: #666; }
    input[type="text"], select, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
    textarea { min-height: 160px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
    .actions { display: flex; gap: 8px; align-items: center; }
    button { padding: 8px 12px; border: 1px solid #ccc; border-radius: 6px; background: #fff; cursor: pointer; }
    button.primary { background: #0b5; color: #fff; border-color: #0b5; }
    pre { background: #0a0a0a10; padding: 12px; border-radius: 8px; overflow: auto; }
    .small { font-size: 12px; }
  </style>
  </head>
<body>
  <header>
    <h1>API 调试</h1>
    <div style="display:flex;gap:8px;align-items:center;">
      <span class="small">基地址</span>
      <input id="baseUrl" value="" placeholder="例如 http://localhost:8080"/>
    </div>
  </header>
  <main>
    <div class="grid">
      <div>
        <label>方法</label>
        <select id="method">
          <option>GET</option>
          <option selected>POST</option>
          <option>PUT</option>
          <option>DELETE</option>
        </select>
      </div>
      <div>
        <label>路径</label>
        <input id="path" placeholder="/api/evidence"/>
      </div>
    </div>
    <div class="grid" style="margin-top:12px">
      <div>
        <label>请求体 JSON</label>
        <textarea id="body">{"eventID":"demo-001","dataHash":"0123456789abcdef"}</textarea>
      </div>
      <div>
        <label>响应</label>
        <pre id="resp"></pre>
      </div>
    </div>
    <div class="actions" style="margin-top:12px">
      <button class="primary" id="send">发送请求</button>
      <button id="preset-submit">提交存证</button>
      <button id="preset-query">查询存证</button>
      <button id="preset-verify">校验存证</button>
    </div>
  </main>
  <script>
    const baseUrlEl = document.getElementById('baseUrl')
    const methodEl = document.getElementById('method')
    const pathEl = document.getElementById('path')
    const bodyEl = document.getElementById('body')
    const respEl = document.getElementById('resp')

    function joinUrl(base, path) {
      base = (base || '').trim()
      path = (path || '').trim()
      if (!base) return path
      if (/^https?:\/\//.test(path)) return path
      const b = base.endsWith('/') ? base.slice(0, -1) : base
      const p = path.startsWith('/') ? path : '/' + path
      return b + p
    }

    async function send() {
      const method = methodEl.value
      const url = joinUrl(baseUrlEl.value, pathEl.value)
      const opts = { method, headers: {} }
      if (method !== 'GET' && bodyEl.value.trim().length) {
        opts.headers['Content-Type'] = 'application/json'
        try { opts.body = JSON.stringify(JSON.parse(bodyEl.value)) } catch { opts.body = bodyEl.value }
      }
      respEl.textContent = ''
      try {
        const r = await fetch(url, opts)
        const text = await r.text()
        try { respEl.textContent = JSON.stringify(JSON.parse(text), null, 2) }
        catch { respEl.textContent = text }
      } catch (e) {
        respEl.textContent = String(e)
      }
    }

    document.getElementById('send').onclick = send
    document.getElementById('preset-submit').onclick = () => {
      methodEl.value = 'POST'
      pathEl.value = '/api/evidence'
      bodyEl.value = JSON.stringify({ eventID: 'demo-001', dataHash: '0123456789abcdef' }, null, 2)
    }
    document.getElementById('preset-query').onclick = () => {
      methodEl.value = 'GET'
      pathEl.value = '/api/evidence/demo-001'
      bodyEl.value = ''
    }
    document.getElementById('preset-verify').onclick = () => {
      methodEl.value = 'POST'
      pathEl.value = '/api/verify'
      bodyEl.value = JSON.stringify({ eventID: 'demo-001', dataHash: '0123456789abcdef' }, null, 2)
    }
  </script>
</body>
</html>
