<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒºå—é“¾å­˜è¯éªŒè¯å¹³å° (Day 4 Demo)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; padding-top: 50px; }
        .container { width: 800px; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .section { margin-bottom: 30px; border: 1px solid #e1e1e1; padding: 20px; border-radius: 5px; }
        .section h2 { margin-top: 0; color: #007bff; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        button.verify-btn { background-color: #28a745; }
        button.verify-btn:hover { background-color: #218838; }
        .result-box { background: #f8f9fa; border: 1px solid #ddd; padding: 15px; margin-top: 15px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; min-height: 50px; word-break: break-all;}
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ”— åŒºå—é“¾å­˜è¯éªŒè¯ä¸­å¿ƒ</h1>

    <div class="section">
        <h2>ğŸ“ å­˜è¯ä¸Šé“¾ (Write)</h2>
        <div class="form-group">
            <label>äº‹ä»¶ ID (Event ID):</label>
            <input type="text" id="input-id" placeholder="ä¾‹å¦‚: ALERT_2024_001">
        </div>
        <div class="form-group">
            <label>æ•°æ®å“ˆå¸Œ (Data Hash):</label>
            <input type="text" id="input-hash" placeholder="ä¾‹å¦‚: a1b2c3d4...">
        </div>
        <div class="form-group">
            <label>å¤‡æ³¨ä¿¡æ¯ (Metadata JSON):</label>
            <input type="text" id="input-meta" placeholder='{"level":"high", "owner":"admin"}' value='{"source":"web-demo"}'>
        </div>
        <button onclick="submitEvidence()">ğŸš€ ç«‹å³ä¸Šé“¾</button>
        <div id="result-submit" class="result-box">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <div class="section">
        <h2>ğŸ” æŸ¥è¯¢ä¸éªŒè¯ (Verify)</h2>
        <div class="form-group">
            <label>è¾“å…¥è¦æŸ¥è¯¢/éªŒè¯çš„äº‹ä»¶ ID:</label>
            <input type="text" id="query-id" placeholder="è¾“å…¥åˆšæ‰ä¸Šé“¾çš„ ID">
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button onclick="queryEvidence()">ğŸ“„ ä»…æŸ¥è¯¢</button>
            <button class="verify-btn" onclick="verifyEvidence()">ğŸ›¡ï¸ éªŒè¯ä¸€è‡´æ€§</button>
        </div>

        <div id="result-query" class="result-box">æŸ¥è¯¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>
</div>

<script>
    const API_BASE = 'http://localhost:8080/api';

    // 1. æäº¤ä¸Šé“¾
    async function submitEvidence() {
        const id = document.getElementById('input-id').value;
        const hash = document.getElementById('input-hash').value;
        const meta = document.getElementById('input-meta').value;
        const resultBox = document.getElementById('result-submit');

        if(!id || !hash) { alert("IDå’Œå“ˆå¸Œä¸èƒ½ä¸ºç©º"); return; }

        resultBox.innerText = "æ­£åœ¨æäº¤åˆ°åŒºå—é“¾ï¼Œè¯·ç¨å€™...";
        
        try {
            const res = await fetch(`${API_BASE}/evidence`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ eventID: id, dataHash: hash, metadata: meta })
            });
            const data = await res.json();
            resultBox.innerHTML = `<span class="${data.status === 'success' ? 'success' : 'error'}">${JSON.stringify(data, null, 2)}</span>`;
        } catch (err) {
            resultBox.innerText = "è¯·æ±‚å¤±è´¥: " + err;
        }
    }

    // 2. æŸ¥è¯¢
    async function queryEvidence() {
        const id = document.getElementById('query-id').value;
        const resultBox = document.getElementById('result-query');
        if(!id) { alert("è¯·è¾“å…¥ID"); return; }

        resultBox.innerText = "æ­£åœ¨æŸ¥è¯¢é“¾ä¸Šè´¦æœ¬...";
        try {
            const res = await fetch(`${API_BASE}/evidence/${id}`);
            const data = await res.json();
            resultBox.innerText = JSON.stringify(data, null, 2);
        } catch (err) {
            resultBox.innerText = "æŸ¥è¯¢å¤±è´¥: " + err;
        }
    }

    // 3. éªŒè¯ (Day 4 æ ¸å¿ƒåŠŸèƒ½)
    async function verifyEvidence() {
        const id = document.getElementById('query-id').value;
        // æ¨¡æ‹Ÿï¼šå‡è®¾æˆ‘ä»¬æœ¬åœ°è¿˜æ˜¯ç”¨åˆšæ‰è¾“å…¥çš„ hash è¿›è¡Œå¯¹æ¯”
        // åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä»æœ¬åœ°æ•°æ®åº“è¯»å‡ºæ¥çš„ hash
        const localHash = document.getElementById('input-hash').value || "mock_local_hash"; 
        
        const resultBox = document.getElementById('result-query');
        if(!id) { alert("è¯·è¾“å…¥ID"); return; }

        resultBox.innerText = `æ­£åœ¨è¿›è¡Œå¯†ç å­¦æ ¡éªŒ...\næœ¬åœ°Hash: ${localHash}\né“¾ä¸ŠHash: (è¯»å–ä¸­...)`;

        try {
            const res = await fetch(`${API_BASE}/verify`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ eventID: id, dataHash: localHash })
            });
            const data = await res.json();
            
            let html = `<strong>æ ¡éªŒç»“æœ: ${data.isMatch ? 'âœ… é€šè¿‡ (ä¸€è‡´)' : 'âŒ å¤±è´¥ (è¢«ç¯¡æ”¹)'}</strong>\n`;
            html += `é“¾ä¸Š Hash: ${data.chainHash}\n`;
            html += `æœ¬åœ° Hash: ${data.localHash}`;
            
            resultBox.innerHTML = html;
            resultBox.style.color = data.isMatch ? 'green' : 'red';
        } catch (err) {
            resultBox.innerText = "éªŒè¯æ¥å£è¯·æ±‚å¤±è´¥: " + err;
        }
    }
</script>
</body>
</html>
